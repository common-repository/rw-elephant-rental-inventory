!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.SignaturePad=b()}(this,function(){"use strict";function a(a,b){void 0===b&&(b=250);var c,d,e,f=0,g=null,h=function(){f=Date.now(),g=null,c=a.apply(d,e),g||(d=null,e=[])};return function(){for(var i=[],j=0;j<arguments.length;j++)i[j]=arguments[j];var k=Date.now(),l=b-(k-f);return d=this,e=i,l<=0||l>b?(g&&(clearTimeout(g),g=null),f=k,c=a.apply(d,e),g||(d=null,e=[])):g||(g=window.setTimeout(h,l)),c}}var b=function(){function a(a,b,c){this.x=a,this.y=b,this.time=c||Date.now()}return a.prototype.distanceTo=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.time===a.time},a.prototype.velocityFrom=function(a){return this.time!==a.time?this.distanceTo(a)/(this.time-a.time):0},a}(),c=function(){function a(a,b,c,d,e,f){this.startPoint=a,this.control2=b,this.control1=c,this.endPoint=d,this.startWidth=e,this.endWidth=f}return a.fromPoints=function(b,c){var d=this.calculateControlPoints(b[0],b[1],b[2]).c2,e=this.calculateControlPoints(b[1],b[2],b[3]).c1;return new a(b[1],d,e,b[2],c.start,c.end)},a.calculateControlPoints=function(a,c,d){var e=a.x-c.x,f=a.y-c.y,g=c.x-d.x,h=c.y-d.y,i={x:(a.x+c.x)/2,y:(a.y+c.y)/2},j={x:(c.x+d.x)/2,y:(c.y+d.y)/2},k=Math.sqrt(e*e+f*f),l=Math.sqrt(g*g+h*h),m=i.x-j.x,n=i.y-j.y,o=l/(k+l),p={x:j.x+m*o,y:j.y+n*o},q=c.x-p.x,r=c.y-p.y;return{c1:new b(i.x+q,i.y+r),c2:new b(j.x+q,j.y+r)}},a.prototype.length=function(){for(var a,b,c=0,d=0;d<=10;d+=1){var e=d/10,f=this.point(e,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),g=this.point(e,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(d>0){var h=f-a,i=g-b;c+=Math.sqrt(h*h+i*i)}a=f,b=g}return c},a.prototype.point=function(a,b,c,d,e){return b*(1-a)*(1-a)*(1-a)+3*c*(1-a)*(1-a)*a+3*d*(1-a)*a*a+e*a*a*a},a}();return function(){function d(b,c){void 0===c&&(c={});var e=this;this.canvas=b,this.options=c,this._handleMouseDown=function(a){1===a.which&&(e._mouseButtonDown=!0,e._strokeBegin(a))},this._handleMouseMove=function(a){e._mouseButtonDown&&e._strokeMoveUpdate(a)},this._handleMouseUp=function(a){1===a.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(a))},this._handleTouchStart=function(a){if(a.preventDefault(),1===a.targetTouches.length){var b=a.changedTouches[0];e._strokeBegin(b)}},this._handleTouchMove=function(a){a.preventDefault();var b=a.targetTouches[0];e._strokeMoveUpdate(b)},this._handleTouchEnd=function(a){if(a.target===e.canvas){a.preventDefault();var b=a.changedTouches[0];e._strokeEnd(b)}},this.velocityFilterWeight=c.velocityFilterWeight||.7,this.minWidth=c.minWidth||.5,this.maxWidth=c.maxWidth||2.5,this.throttle="throttle"in c?c.throttle:16,this.minDistance="minDistance"in c?c.minDistance:5,this.throttle?this._strokeMoveUpdate=a(d.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=d.prototype._strokeUpdate,this.dotSize=c.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=c.penColor||"black",this.backgroundColor=c.backgroundColor||"rgba(0,0,0,0)",this.onBegin=c.onBegin,this.onEnd=c.onEnd,this._ctx=b.getContext("2d"),this.clear(),this.on()}return d.prototype.clear=function(){var a=this._ctx,b=this.canvas;a.fillStyle=this.backgroundColor,a.clearRect(0,0,b.width,b.height),a.fillRect(0,0,b.width,b.height),this._data=[],this._reset(),this._isEmpty=!0},d.prototype.fromDataURL=function(a,b,c){var d=this;void 0===b&&(b={});var e=new Image,f=b.ratio||window.devicePixelRatio||1,g=b.width||this.canvas.width/f,h=b.height||this.canvas.height/f;this._reset(),e.onload=function(){d._ctx.drawImage(e,0,0,g,h),c&&c()},e.onerror=function(a){c&&c(a)},e.src=a,this._isEmpty=!1},d.prototype.toDataURL=function(a,b){switch(void 0===a&&(a="image/png"),a){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(a,b)}},d.prototype.on=function(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())},d.prototype.off=function(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)},d.prototype.isEmpty=function(){return this._isEmpty},d.prototype.fromData=function(a){var b=this;this.clear(),this._fromData(a,function(a){var c=a.color,d=a.curve;return b._drawCurve({color:c,curve:d})},function(a){var c=a.color,d=a.point;return b._drawDot({color:c,point:d})}),this._data=a},d.prototype.toData=function(){return this._data},d.prototype._strokeBegin=function(a){var b={color:this.penColor,points:[]};"function"==typeof this.onBegin&&this.onBegin(a),this._data.push(b),this._reset(),this._strokeUpdate(a)},d.prototype._strokeUpdate=function(a){var b=a.clientX,c=a.clientY,d=this._createPoint(b,c),e=this._data[this._data.length-1],f=e.points,g=f.length>0&&f[f.length-1],h=!!g&&d.distanceTo(g)<=this.minDistance,i=e.color;if(!g||!g||!h){var j=this._addPoint(d);g?j&&this._drawCurve({color:i,curve:j}):this._drawDot({color:i,point:d}),f.push({time:d.time,x:d.x,y:d.y})}},d.prototype._strokeEnd=function(a){this._strokeUpdate(a),"function"==typeof this.onEnd&&this.onEnd(a)},d.prototype._handlePointerEvents=function(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)},d.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},d.prototype._handleTouchEvents=function(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)},d.prototype._reset=function(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},d.prototype._createPoint=function(a,c){var d=this.canvas.getBoundingClientRect();return new b(a-d.left,c-d.top,(new Date).getTime())},d.prototype._addPoint=function(a){var b=this._lastPoints;if(b.push(a),b.length>2){3===b.length&&b.unshift(b[0]);var d=this._calculateCurveWidths(b[1],b[2]),e=c.fromPoints(b,d);return b.shift(),e}return null},d.prototype._calculateCurveWidths=function(a,b){var c=this.velocityFilterWeight*b.velocityFrom(a)+(1-this.velocityFilterWeight)*this._lastVelocity,d=this._strokeWidth(c),e={end:d,start:this._lastWidth};return this._lastVelocity=c,this._lastWidth=d,e},d.prototype._strokeWidth=function(a){return Math.max(this.maxWidth/(a+1),this.minWidth)},d.prototype._drawCurveSegment=function(a,b,c){var d=this._ctx;d.moveTo(a,b),d.arc(a,b,c,0,2*Math.PI,!1),this._isEmpty=!1},d.prototype._drawCurve=function(a){var b=a.color,c=a.curve,d=this._ctx,e=c.endWidth-c.startWidth,f=2*Math.floor(c.length());d.beginPath(),d.fillStyle=b;for(var g=0;g<f;g+=1){var h=g/f,i=h*h,j=i*h,k=1-h,l=k*k,m=l*k,n=m*c.startPoint.x;n+=3*l*h*c.control1.x,n+=3*k*i*c.control2.x,n+=j*c.endPoint.x;var o=m*c.startPoint.y;o+=3*l*h*c.control1.y,o+=3*k*i*c.control2.y,o+=j*c.endPoint.y;var p=c.startWidth+j*e;this._drawCurveSegment(n,o,p)}d.closePath(),d.fill()},d.prototype._drawDot=function(a){var b=a.color,c=a.point,d=this._ctx,e="function"==typeof this.dotSize?this.dotSize():this.dotSize;d.beginPath(),this._drawCurveSegment(c.x,c.y,e),d.closePath(),d.fillStyle=b,d.fill()},d.prototype._fromData=function(a,c,d){for(var e=0,f=a;e<f.length;e++){var g=f[e],h=g.color,i=g.points;if(i.length>1)for(var j=0;j<i.length;j+=1){var k=i[j],l=new b(k.x,k.y,k.time);this.penColor=h,0===j&&this._reset();var m=this._addPoint(l);m&&c({color:h,curve:m})}else this._reset(),d({color:h,point:i[0]})}},d.prototype._toSVG=function(){var a=this,b=this._data,c=Math.max(window.devicePixelRatio||1,1),d=this.canvas.width/c,e=this.canvas.height/c,f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("width",this.canvas.width.toString()),f.setAttribute("height",this.canvas.height.toString()),this._fromData(b,function(a){var b=a.color,c=a.curve,d=document.createElement("path");if(!(isNaN(c.control1.x)||isNaN(c.control1.y)||isNaN(c.control2.x)||isNaN(c.control2.y))){var e="M "+c.startPoint.x.toFixed(3)+","+c.startPoint.y.toFixed(3)+" C "+c.control1.x.toFixed(3)+","+c.control1.y.toFixed(3)+" "+c.control2.x.toFixed(3)+","+c.control2.y.toFixed(3)+" "+c.endPoint.x.toFixed(3)+","+c.endPoint.y.toFixed(3);d.setAttribute("d",e),d.setAttribute("stroke-width",(2.25*c.endWidth).toFixed(3)),d.setAttribute("stroke",b),d.setAttribute("fill","none"),d.setAttribute("stroke-linecap","round"),f.appendChild(d)}},function(b){var c=b.color,d=b.point,e=document.createElement("circle"),g="function"==typeof a.dotSize?a.dotSize():a.dotSize;e.setAttribute("r",g.toString()),e.setAttribute("cx",d.x.toString()),e.setAttribute("cy",d.y.toString()),e.setAttribute("fill",c),f.appendChild(e)});var g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+d+" "+e+'" width="'+d+'" height="'+e+'">',h=f.innerHTML;if(void 0===h){var i=document.createElement("dummy"),j=f.childNodes;i.innerHTML="";for(var k=0;k<j.length;k+=1)i.appendChild(j[k].cloneNode(!0));h=i.innerHTML}var l=g+h+"</svg>";return"data:image/svg+xml;base64,"+btoa(l)},d}()});